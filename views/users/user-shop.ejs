<style>
  .colored-toast.swal2-icon-success {
    background-color: #a5dc86 !important;
  }

  .colored-toast.swal2-icon-error {
    background-color: #f27474 !important;
  }

  .colored-toast.swal2-icon-warning {
    background-color: #f8bb86 !important;
  }

  .colored-toast.swal2-icon-info {
    background-color: #3fc3ee !important;
  }

  .colored-toast.swal2-icon-question {
    background-color: #87adbd !important;
  }

  .colored-toast .swal2-title {
    color: white;
  }

  .colored-toast .swal2-close {
    color: white;
  }

  .colored-toast .swal2-html-container {
    color: white;
  }
</style>

<section>
  <main class="main">
    <div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
      <div class="container-fluid">
        <h1 class="page-title">EXPERIENCE THE GREATEST COLLECTIONS<span>SHOP</span></h1>
      </div><!-- End .container-fluid -->
    </div><!-- End .page-header -->
    <nav aria-label="breadcrumb" class="breadcrumb-nav mb-2">
      <div class="container-fluid">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/">Home</a></li>
          <!-- <li class="breadcrumb-item"><a href="#">Shop</a></li> -->
          <!-- <li class="breadcrumb-item"><a href="#">No Sidebar</a></li>-->
          <li class="breadcrumb-item active" aria-current="page">shop</li>
        </ol>
      </div><!-- End .container-fluid -->
    </nav><!-- End .breadcrumb-nav -->

    <div class="container-fluid">
      <div class="toolbox">
        <div class="toolbox-left">
          <a href="#" class="sidebar-toggler"><i class="icon-bars"></i>Filters</a>
        </div><!-- End .toolbox-left -->



        <% console.log(products,"here") %>
      </div><!-- End .toolbox -->
      <div class="products">
        <div class="row">
          <% products.forEach((products)=>{%>


          <div class="col-6 col-md-4 col-lg-4 col-xl-3 col-xxl-2">
            <div class="product">
              <figure class="product-media">
                <span class="product-label label-new" style="background-color: rgb(112, 185, 40);"><%=products.offerpercentage%>% off</span>
                <a href="/products/<%= products._id  %>">
                  <img src="/productimages/<%= products.img[0] %>" alt="Product image" class="product-image">
                </a>

                <div class="product-action-vertical">
                  <a onclick="addtowishlist('<%=products._id%>')" class="btn-product-icon btn-wishlist btn-expandable"><span>add to
                      wishlist</span></a>
                </div><!-- End .product-action -->

                <div class="product-action action-icon-top">
                  <a class="btn-product btn-cart" onclick="addToCart('<%-products._id %>','<%=products.stock%>')"><span>add to cart</span></a>
                  <a href="popup/quickView.html" class="btn-product btn-quickview" title="Quick view"><span>quick view</span></a>
                  <a href="#" class="btn-product btn-compare" title="Compare"><span>compare</span></a>
                </div><!-- End .product-action -->
              </figure><!-- End .product-media -->

              <div class="product-body">
                <div class="product-cat">
                  <a href="#" class="text-danger">
                    <%= products.catogory %>
                  </a>
                </div><!-- End .product-cat -->
                <h3 class="product-title"><a href="">
                    <%= products.name %>
                  </a></h3><!-- End .product-title -->
                <div class="product-price">
                  <s class="text-danger pr-2">₹<%= products.price %></s><span>₹<%= products.offerprice %></span>
                </div><!-- End .product-price -->
                <div class="ratings-container">
                  <div class="ratings">
                    <div class="ratings-val" style="width: 80%;"></div><!-- End .ratings-val -->
                  </div><!-- End .ratings -->
                  <span class="ratings-text">( 6 Reviews )</span>
                </div><!-- End .rating-container -->

              </div><!-- End .product-body -->
            </div><!-- End .product -->
          </div><!-- End .col-sm-6 col-lg-4 col-xl-3 -->
          <% }) %>





        </div><!-- End .row -->

        <div class="load-more-container text-center">
          <a href="#" class="btn btn-outline-darker btn-load-more">More Products <i class="icon-refresh"></i></a>
        </div><!-- End .load-more-container -->
      </div><!-- End .products -->

      <div class="sidebar-filter-overlay"></div><!-- End .sidebar-filter-overlay -->
      <aside class="sidebar-shop sidebar-filter">
        <div class="sidebar-filter-wrapper">
          <div class="widget widget-clean">
            <label><i class="icon-close"></i>Filters</label>
            <a href="#" class="sidebar-filter-clear">Clean All</a>
          </div><!-- End .widget -->
          <div class="widget widget-collapsible">
            <h3 class="widget-title">
              <a data-toggle="collapse" href="#widget-1" role="button" aria-expanded="true" aria-controls="widget-1">
                Category
              </a>
            </h3><!-- End .widget-title -->

            <div class="collapse show" id="widget-1">
              <div class="widget-body">
                <div class="filter-items filter-items-count">
                  <div class="filter-item">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="cat-1">
                      <label class="custom-control-label" for="cat-1">Dresses</label>
                    </div><!-- End .custom-checkbox -->
                    <span class="item-count">3</span>
                  </div><!-- End .filter-item -->

                  <div class="filter-item">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="cat-2">
                      <label class="custom-control-label" for="cat-2">T-shirts</label>
                    </div><!-- End .custom-checkbox -->
                    <span class="item-count">0</span>
                  </div><!-- End .filter-item -->

                  <div class="filter-item">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="cat-3">
                      <label class="custom-control-label" for="cat-3">Bags</label>
                    </div><!-- End .custom-checkbox -->
                    <span class="item-count">4</span>
                  </div><!-- End .filter-item -->

                  <div class="filter-item">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="cat-4">
                      <label class="custom-control-label" for="cat-4">Jackets</label>
                    </div><!-- End .custom-checkbox -->
                    <span class="item-count">2</span>
                  </div><!-- End .filter-item -->

                  <div class="filter-item">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="cat-5">
                      <label class="custom-control-label" for="cat-5">Shoes</label>
                    </div><!-- End .custom-checkbox -->
                    <span class="item-count">2</span>
                  </div><!-- End .filter-item -->

                  <div class="filter-item">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="cat-6">
                      <label class="custom-control-label" for="cat-6">Jumpers</label>
                    </div><!-- End .custom-checkbox -->
                    <span class="item-count">1</span>
                  </div><!-- End .filter-item -->

                  <div class="filter-item">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="cat-7">
                      <label class="custom-control-label" for="cat-7">Jeans</label>
                    </div><!-- End .custom-checkbox -->
                    <span class="item-count">1</span>
                  </div><!-- End .filter-item -->

                  <div class="filter-item">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="cat-8">
                      <label class="custom-control-label" for="cat-8">Sportwear</label>
                    </div><!-- End .custom-checkbox -->
                    <span class="item-count">0</span>
                  </div><!-- End .filter-item -->
                </div><!-- End .filter-items -->
              </div><!-- End .widget-body -->
            </div><!-- End .collapse -->
          </div><!-- End .widget -->

          <div class="widget widget-collapsible">
            <h3 class="widget-title">
              <a data-toggle="collapse" href="#widget-2" role="button" aria-expanded="true" aria-controls="widget-2">
                Size
              </a>
            </h3><!-- End .widget-title -->

            <div class="collapse show" id="widget-2">
              <div class="widget-body">
                <div class="filter-items">
                  <div class="filter-item">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="size-1">
                      <label class="custom-control-label" for="size-1">XS</label>
                    </div><!-- End .custom-checkbox -->
                  </div><!-- End .filter-item -->

                  <div class="filter-item">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="size-2">
                      <label class="custom-control-label" for="size-2">S</label>
                    </div><!-- End .custom-checkbox -->
                  </div><!-- End .filter-item -->

                  <div class="filter-item">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" checked id="size-3">
                      <label class="custom-control-label" for="size-3">M</label>
                    </div><!-- End .custom-checkbox -->
                  </div><!-- End .filter-item -->

                  <div class="filter-item">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" checked id="size-4">
                      <label class="custom-control-label" for="size-4">L</label>
                    </div><!-- End .custom-checkbox -->
                  </div><!-- End .filter-item -->

                  <div class="filter-item">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="size-5">
                      <label class="custom-control-label" for="size-5">XL</label>
                    </div><!-- End .custom-checkbox -->
                  </div><!-- End .filter-item -->

                  <div class="filter-item">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="size-6">
                      <label class="custom-control-label" for="size-6">XXL</label>
                    </div><!-- End .custom-checkbox -->
                  </div><!-- End .filter-item -->
                </div><!-- End .filter-items -->
              </div><!-- End .widget-body -->
            </div><!-- End .collapse -->
          </div><!-- End .widget -->

          <div class="widget widget-collapsible">
            <h3 class="widget-title">
              <a data-toggle="collapse" href="#widget-3" role="button" aria-expanded="true" aria-controls="widget-3">
                Colour
              </a>
            </h3><!-- End .widget-title -->

            <div class="collapse show" id="widget-3">
              <div class="widget-body">
                <div class="filter-colors">
                  <a href="#" style="background: #b87145;"><span class="sr-only">Color Name</span></a>
                  <a href="#" style="background: #f0c04a;"><span class="sr-only">Color Name</span></a>
                  <a href="#" style="background: #333333;"><span class="sr-only">Color Name</span></a>
                  <a href="#" class="selected" style="background: #cc3333;"><span class="sr-only">Color Name</span></a>
                  <a href="#" style="background: #3399cc;"><span class="sr-only">Color Name</span></a>
                  <a href="#" style="background: #669933;"><span class="sr-only">Color Name</span></a>
                  <a href="#" style="background: #f2719c;"><span class="sr-only">Color Name</span></a>
                  <a href="#" style="background: #ebebeb;"><span class="sr-only">Color Name</span></a>
                </div><!-- End .filter-colors -->
              </div><!-- End .widget-body -->
            </div><!-- End .collapse -->
          </div><!-- End .widget -->

          <div class="widget widget-collapsible">
            <h3 class="widget-title">
              <a data-toggle="collapse" href="#widget-4" role="button" aria-expanded="true" aria-controls="widget-4">
                Brand
              </a>
            </h3><!-- End .widget-title -->

            <div class="collapse show" id="widget-4">
              <div class="widget-body">
                <div class="filter-items">
                  <div class="filter-item">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="brand-1">
                      <label class="custom-control-label" for="brand-1">Next</label>
                    </div><!-- End .custom-checkbox -->
                  </div><!-- End .filter-item -->

                  <div class="filter-item">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="brand-2">
                      <label class="custom-control-label" for="brand-2">River Island</label>
                    </div><!-- End .custom-checkbox -->
                  </div><!-- End .filter-item -->

                  <div class="filter-item">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="brand-3">
                      <label class="custom-control-label" for="brand-3">Geox</label>
                    </div><!-- End .custom-checkbox -->
                  </div><!-- End .filter-item -->

                  <div class="filter-item">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="brand-4">
                      <label class="custom-control-label" for="brand-4">New Balance</label>
                    </div><!-- End .custom-checkbox -->
                  </div><!-- End .filter-item -->

                  <div class="filter-item">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="brand-5">
                      <label class="custom-control-label" for="brand-5">UGG</label>
                    </div><!-- End .custom-checkbox -->
                  </div><!-- End .filter-item -->

                  <div class="filter-item">

                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="brand-6">
                      <label class="custom-control-label" for="brand-6">F&F</label>
                    </div><!-- End .custom-checkbox -->
                  </div><!-- End .filter-item -->

                  <div class="filter-item">
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" id="brand-7">
                      <label class="custom-control-label" for="brand-7">Nike</label>
                    </div><!-- End .custom-checkbox -->
                  </div><!-- End .filter-item -->

                </div><!-- End .filter-items -->
              </div><!-- End .widget-body -->
            </div><!-- End .collapse -->
          </div><!-- End .widget -->

          <div class="widget widget-collapsible">
            <h3 class="widget-title">
              <a data-toggle="collapse" href="#widget-5" role="button" aria-expanded="true" aria-controls="widget-5">
                Price
              </a>
            </h3><!-- End .widget-title -->

            <div class="collapse show" id="widget-5">
              <div class="widget-body">
                <div class="filter-price">
                  <div class="filter-price-text">
                    Price Range:
                    <span id="filter-price-range"></span>
                  </div><!-- End .filter-price-text -->

                  <div id="price-slider"></div><!-- End #price-slider -->
                </div><!-- End .filter-price -->
              </div><!-- End .widget-body -->
            </div><!-- End .collapse -->
          </div><!-- End .widget -->
        </div><!-- End .sidebar-filter-wrapper -->
      </aside><!-- End .sidebar-filter -->
    </div><!-- End .container-fluid -->
    </div><!-- End .page-content -->
  </main><!-- End .main -->
</section>




<footer class="footer">
  <div class="footer-middle">
    <div class="container">
      <div class="row">
        <div class="col-sm-6 col-lg-3">
          <div class="widget widget-about">
            <img src="/assets/images/uptownlogo.jpg" class="footer-logo" alt="Footer Logo" width="105" height="25">
            <p>Praesent dapibus, neque id cursus ucibus, tortor neque egestas augue, eu vulputate magna eros
              eu erat. </p>

            <div class="social-icons">
              <a href="#" class="social-icon" target="_blank" title="Facebook"><i class="icon-facebook-f"></i></a>
              <a href="#" class="social-icon" target="_blank" title="Twitter"><i class="icon-twitter"></i></a>
              <a href="#" class="social-icon" target="_blank" title="Instagram"><i class="icon-instagram"></i></a>
              <a href="#" class="social-icon" target="_blank" title="Youtube"><i class="icon-youtube"></i></a>
              <a href="#" class="social-icon" target="_blank" title="Pinterest"><i class="icon-pinterest"></i></a>
            </div><!-- End .soial-icons -->
          </div><!-- End .widget about-widget -->
        </div><!-- End .col-sm-6 col-lg-3 -->

        <div class="col-sm-6 col-lg-3">
          <div class="widget">
            <h4 class="widget-title">Useful Links</h4><!-- End .widget-title -->

            <ul class="widget-list">
              <li><a href="about.html">About Molla</a></li>
              <li><a href="#">How to shop on Molla</a></li>
              <li><a href="#">FAQ</a></li>
              <li><a href="contact.html">Contact us</a></li>
              <li><a href="login.html">Log in</a></li>
            </ul><!-- End .widget-list -->
          </div><!-- End .widget -->
        </div><!-- End .col-sm-6 col-lg-3 -->

        <div class="col-sm-6 col-lg-3">
          <div class="widget">
            <h4 class="widget-title">Customer Service</h4><!-- End .widget-title -->

            <ul class="widget-list">
              <li><a href="#">Payment Methods</a></li>
              <li><a href="#">Money-back guarantee!</a></li>
              <li><a href="#">Returns</a></li>
              <li><a href="#">Shipping</a></li>
              <li><a href="#">Terms and conditions</a></li>
              <li><a href="#">Privacy Policy</a></li>
            </ul><!-- End .widget-list -->
          </div><!-- End .widget -->
        </div><!-- End .col-sm-6 col-lg-3 -->

        <div class="col-sm-6 col-lg-3">
          <div class="widget">
            <h4 class="widget-title">My Account</h4><!-- End .widget-title -->

            <ul class="widget-list">
              <li><a href="#">Sign In</a></li>
              <li><a href="cart.html">View Cart</a></li>
              <li><a href="#">My Wishlist</a></li>
              <li><a href="#">Track My Order</a></li>
              <li><a href="#">Help</a></li>
            </ul><!-- End .widget-list -->
          </div><!-- End .widget -->
        </div><!-- End .col-sm-6 col-lg-3 -->
      </div><!-- End .row -->
    </div><!-- End .container -->
  </div><!-- End .footer-middle -->

  <div class="footer-bottom">
    <div class="container">
      <p class="footer-copyright">Copyright © 2019 Molla Store. All Rights Reserved.</p>
      <!-- End .footer-copyright -->
      <figure class="footer-payments">
        <img src="assets/images/payments.png" alt="Payment methods" width="272" height="20">
      </figure><!-- End .footer-payments -->
    </div><!-- End .container -->
  </div><!-- End .footer-bottom -->
</footer><!-- End .footer -->

<script>
  function addToCart(proId, stock) {
    console.log("proid=>", proId, "stock=>", stock);
    $.ajax({
      url: '/check-cart-quantity/' + proId,
      method: 'get',
      success: (response) => {

        //checking if user login or not
        if (response.login == false) {
          console.log(response, 'this is my respones');
          Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'Please Login To Continue',
          })
        } else {

          if (response.status) {
            if (stock - response.quantity <= 0) {
              toast2()
            } else {
              $.ajax({
                url: '/add-to-cart/' + proId,
                method: 'get',

                success: (response) => {

                  if (response.status) {
                    toast1()
                    let count = $('#cart-count').html()
                    console.log(count, "is count");
                    count = parseInt(count) + 1
                    $('#cart-count').html(count)

                  }
                }
              })
            }

          } else if (response.status == false && stock == 0) {
            toast2()
          }
          //   user exsist but no cart condition
          else {
            $.ajax({
              url: '/add-to-cart/' + proId,
              method: 'get',
              success: (response) => {
                if (response.status) {
                  toast1()
                  let count = $('#cart-count').html()
                  console.log(count, "is count");
                  count = parseInt(count) + 1
                  $('#cart-count').html(count)
                }
              }
            })
          }
        }
      }
    })




  }
  async function toast1() {
    const Toast = Swal.mixin({
      toast: true,
      position: 'bottom',
      iconColor: 'white',
      customClass: {
        popup: 'colored-toast'
      },
      showConfirmButton: false,
      timer: 1500,
      timerProgressBar: true
    })
    await Toast.fire({
      icon: 'success',
      title: 'ITEM ADDED TO CART'
    })
  }

  async function toast2() {
    const Toast = Swal.mixin({
      toast: true,
      position: 'bottom',
      iconColor: 'white',
      customClass: {
        popup: 'colored-toast'
      },
      showConfirmButton: false,
      timer: 1500,
      timerProgressBar: true
    })
    await Toast.fire({
      icon: 'error',
      title: 'ITEM OUT OF STOCK'
    })

  }

  function addtowishlist(proId) {

    $.ajax({
      url: '/add-wishlist/' + proId,
      method: 'post',
      success: (response) => {
        if (response.status == 'success') {
          Swal.fire({
            icon: 'success',
            title: 'Item Added To wishlist ',
            showConfirmButton: false,
            timer: 1500
          })
        } else {
          Swal.fire('Item already added')
        }
      }
    })
  }
</script>